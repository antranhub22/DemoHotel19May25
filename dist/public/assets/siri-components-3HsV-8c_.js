import{r as m,j as p}from"./react-core-C6DwaHZM.js";import{a5 as X}from"./components-CjbIaAhs.js";import{a as Y,j as W}from"./hooks-context-CVvU1W40.js";class f{static{this.DEBUG_LEVEL=0}static setDebugLevel(e){f.DEBUG_LEVEL=e,console.log(`[DebugManager] Debug level set to: ${e} (0: off, 1: errors only, 2: all)`)}static getDebugLevel(){return f.DEBUG_LEVEL}log(e,...t){f.DEBUG_LEVEL>=2&&console.log(`[SiriButton] ${e}`,...t)}debug(e,...t){f.DEBUG_LEVEL>=2&&console.log(`[SiriButton] ${e}`,...t)}warn(e,...t){f.DEBUG_LEVEL>=1&&console.warn(`[SiriButton] ${e}`,...t)}debugWarn(e,...t){f.DEBUG_LEVEL>=1&&console.warn(`[SiriButton] ${e}`,...t)}error(e,...t){console.error(`[SiriButton] ${e}`,...t)}debugError(e,...t){console.error(`[SiriButton] ${e}`,...t)}silent(){f.setDebugLevel(0)}errorsOnly(){f.setDebugLevel(1)}verbose(){f.setDebugLevel(2)}}typeof window<"u"&&(window.SiriDebugControls={setLevel:l=>{f.setDebugLevel(l),console.log(`🔧 Voice debug level set to: ${l}`)},getLevel:()=>f.getDebugLevel(),silent:()=>f.setDebugLevel(0),errorsOnly:()=>f.setDebugLevel(1),verbose:()=>f.setDebugLevel(2),help:()=>{console.log(`
🔧 SiriDebugControls Help:
- SiriDebugControls.silent()     -> Turn off all debug logs
- SiriDebugControls.errorsOnly() -> Show errors + warnings only  
- SiriDebugControls.verbose()    -> Show all debug logs
- SiriDebugControls.setLevel(n)  -> Set level manually (0-2)
- SiriDebugControls.getLevel()   -> Check current level
      `)}},window.voiceDebugOff=()=>f.setDebugLevel(0),window.voiceDebugOn=()=>f.setDebugLevel(2));class G{constructor(e){this.debug=e,this.canvas=null,this.ctx=null,this.state={emergencyStopRequested:!1,resizeInProgress:!1,lastResizeTime:0,maxResizeAttempts:5,resizeAttemptCount:0,canvasValid:!0}}setCanvasReferences(e,t){this.canvas=e,this.ctx=t,this.state.canvasValid=!0}isEmergencyStopRequested(){return this.state.emergencyStopRequested}triggerEmergencyStop(){this.debug.warn("🚨 EMERGENCY STOP TRIGGERED"),this.state.emergencyStopRequested=!0,this.state.canvasValid=!1}clearEmergencyStop(){this.debug.log("✅ Emergency stop cleared"),this.state.emergencyStopRequested=!1,this.validateCanvas()}validateCanvas(){return!this.canvas||!this.ctx?(this.debug.error("Canvas or context invalid"),this.state.canvasValid=!1,!1):!this.canvas.parentElement||!document.contains(this.canvas)?(this.debug.error("Canvas not in DOM"),this.state.canvasValid=!1,!1):this.canvas.width===0||this.canvas.height===0?(this.debug.warn("Canvas has zero dimensions"),this.state.canvasValid=!1,!1):(this.state.canvasValid=!0,!0)}isCanvasValid(){return this.state.canvasValid}canSafeResize(){const e=Date.now();return this.state.resizeInProgress?(this.debug.warn("Resize already in progress, skipping"),!1):e-this.state.lastResizeTime<100?(this.debug.warn("Resize attempted too recently, skipping"),!1):this.state.resizeAttemptCount>=this.state.maxResizeAttempts?(this.debug.error("Maximum resize attempts reached, stopping"),this.triggerEmergencyStop(),!1):!0}startResize(){return this.canSafeResize()?(this.state.resizeInProgress=!0,this.state.lastResizeTime=Date.now(),this.state.resizeAttemptCount++,this.debug.log(`Starting resize attempt ${this.state.resizeAttemptCount}/${this.state.maxResizeAttempts}`),!0):!1}finishResize(e){this.state.resizeInProgress=!1,e?(this.debug.log("Resize completed successfully"),this.state.resizeAttemptCount=0):(this.debug.warn("Resize failed"),this.state.resizeAttemptCount>=this.state.maxResizeAttempts&&(this.debug.error("Max resize attempts reached, triggering emergency stop"),this.triggerEmergencyStop()))}resetResizeAttempts(){this.state.resizeAttemptCount=0,this.debug.log("Resize attempt counter reset")}safeExecute(e,t,i){try{return this.state.emergencyStopRequested?(this.debug.warn(`Operation ${i} skipped due to emergency stop`),t()):e()}catch(n){this.debug.error(`Operation ${i} failed:`,n);try{return t()}catch(r){throw this.debug.error(`Fallback for ${i} also failed:`,r),this.triggerEmergencyStop(),r}}}safeCanvasOperation(e,t,i){return this.validateCanvas()?this.safeExecute(e,t,i):(this.debug.warn(`Canvas operation ${i} skipped - canvas invalid`),t())}setFallbackDimensions(){try{const e={width:300,height:300,centerX:150,centerY:150,radius:100};return this.canvas&&(this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`),this.debug.warn("Using fallback dimensions due to resize failure"),e}catch(e){throw this.debug.error("Failed to set fallback dimensions:",e),this.triggerEmergencyStop(),e}}getState(){return{...this.state}}shouldSkipAnimation(){return this.state.emergencyStopRequested||!this.state.canvasValid}forceReset(){this.debug.warn("🔧 Force resetting emergency state"),this.state={emergencyStopRequested:!1,resizeInProgress:!1,lastResizeTime:0,maxResizeAttempts:5,resizeAttemptCount:0,canvasValid:!0}}}class q{constructor(e,t){this.ctx=e,this.debug=t}clear(e){try{this.ctx.clearRect(0,0,e.width,e.height)}catch(t){throw this.debug.error("Error clearing canvas:",t),t}}renderAll(e){try{this.clear(e),this.drawBaseCircle(e),this.drawWaveform(e),this.drawParticles(e),this.drawRipples(e),this.drawPulsingRing(e),this.drawTimeRing(e),this.drawTimeText(e),this.drawIdleFlash(e)}catch(t){this.debug.error("Error during complete rendering:",t),this.drawFallbackCircle(e)}}drawBaseCircle(e){const{centerX:t,centerY:i,radius:n,isActive:r,isHovered:a,colors:s}=e;this.ctx.save();const h=n*(r?1.08:a?1.04:1),u=this.ctx.createRadialGradient(t,i,0,t,i,h);u.addColorStop(0,s.primary+"95"),u.addColorStop(.7,s.secondary+"60"),u.addColorStop(1,s.glow+"20"),this.ctx.beginPath(),this.ctx.arc(t,i,h+15,0,Math.PI*2),this.ctx.fillStyle=s.glow+"30",this.ctx.filter="blur(8px)",this.ctx.fill(),this.ctx.filter="none",this.ctx.beginPath(),this.ctx.arc(t,i,h,0,Math.PI*2),this.ctx.fillStyle=u,this.ctx.fill();const o=this.ctx.createRadialGradient(t-n*.3,i-n*.3,0,t,i,n*.8);o.addColorStop(0,"rgba(255, 255, 255, 0.4)"),o.addColorStop(1,"rgba(255, 255, 255, 0)"),this.ctx.beginPath(),this.ctx.arc(t,i,h*.8,0,Math.PI*2),this.ctx.fillStyle=o,this.ctx.fill(),this.ctx.restore()}drawWaveform(e){if(!e.isListening)return;const{centerX:t,centerY:i,radius:n,waveformPhase:r,volumeLevel:a,colors:s}=e;this.ctx.save();for(let c=0;c<3;c++){const h=n*(1.15+c*.1),u=32;this.ctx.beginPath();for(let o=0;o<=u;o++){const y=o/u*Math.PI*2,b=Math.sin(r+o*.3+c*1.5)*(8+a*12),x=h+b,S=t+Math.cos(y)*x,v=i+Math.sin(y)*x;o===0?this.ctx.moveTo(S,v):this.ctx.lineTo(S,v)}this.ctx.closePath(),this.ctx.strokeStyle=s.secondary+(90-c*20).toString(16),this.ctx.lineWidth=2,this.ctx.shadowColor=s.glow,this.ctx.shadowBlur=6,this.ctx.stroke()}this.ctx.restore()}drawParticles(e){const{particles:t,colors:i}=e;for(let n=t.length-1;n>=0;n--){const r=t[n];if(r.alpha-=.008,r.size-=.05,r.x+=(Math.random()-.5)*r.speed,r.y+=(Math.random()-.5)*r.speed,r.alpha<=.05||r.size<.5){t.splice(n,1);continue}this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(r.x,r.y,r.size,0,Math.PI*2);const a=Math.floor(255*r.alpha).toString(16).padStart(2,"0");this.ctx.fillStyle=i.secondary+a,this.ctx.shadowColor=i.glow,this.ctx.shadowBlur=6,this.ctx.fill(),this.ctx.restore()}}drawRipples(e){const{ripples:t,centerX:i,centerY:n,colors:r}=e;for(let a=t.length-1;a>=0;a--){const s=t[a];if(s.radius+=s.speed*3,s.alpha-=.02,s.alpha<=0){t.splice(a,1);continue}this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(i,n,s.radius,0,Math.PI*2);const c=Math.floor(255*s.alpha).toString(16).padStart(2,"0");this.ctx.strokeStyle=r.primary+c,this.ctx.lineWidth=2,this.ctx.shadowColor=r.glow,this.ctx.shadowBlur=8,this.ctx.stroke(),this.ctx.restore()}}drawPulsingRing(e){const{centerX:t,centerY:i,radius:n,pulsePhase:r,isListening:a,colors:s}=e;if(!a)return;this.ctx.save();const c=.9+.2*Math.sin(r*1.5),h=n*(1.25+c*.1);this.ctx.beginPath(),this.ctx.arc(t,i,h,0,Math.PI*2),this.ctx.strokeStyle=s.glow+"60",this.ctx.lineWidth=3,this.ctx.shadowColor=s.glow,this.ctx.shadowBlur=15,this.ctx.stroke(),this.ctx.restore()}drawTimeRing(e){const{centerX:t,centerY:i,radius:n,elapsedTime:r,timeTarget:a,colors:s}=e,c=Math.min(1,r/a),h=c<.5?s.secondary:c<1?s.primary:"#e53935";this.ctx.save(),this.ctx.beginPath(),this.ctx.arc(t,i,n*1.32,-Math.PI/2,-Math.PI/2+c*2*Math.PI),this.ctx.strokeStyle=h,this.ctx.lineWidth=4,this.ctx.shadowColor=h,this.ctx.shadowBlur=c>.95?16:6,this.ctx.globalAlpha=.85,this.ctx.stroke(),this.ctx.restore()}drawTimeText(e){const{centerX:t,centerY:i,radius:n,displayedTime:r,isDarkMode:a}=e,s=Math.round(r),c=Math.floor(s/60).toString().padStart(2,"0"),h=(s%60).toString().padStart(2,"0"),u=`${c}:${h}`;this.ctx.save(),this.ctx.font="600 1.25rem Montserrat, Raleway, Arial, sans-serif",this.ctx.textAlign="center",this.ctx.textBaseline="top",this.ctx.shadowColor="rgba(85,154,154,0.22)",this.ctx.shadowBlur=8,this.ctx.fillStyle=a?"#e8e8e8":"#fff",this.ctx.globalAlpha=.95,this.ctx.fillText(u,t,i+n*1.45),this.ctx.restore()}drawIdleFlash(e){const{centerX:t,centerY:i,radius:n,lastActiveTime:r,idleFlash:a,colors:s}=e;if(Date.now()-r<=6e3)return;const h=.7+.3*Math.abs(Math.sin(a*1.2));this.ctx.save(),this.ctx.globalAlpha=.18*h,this.ctx.beginPath(),this.ctx.arc(t,i,n*1.18,0,Math.PI*2),this.ctx.fillStyle=s.secondary,this.ctx.filter="blur(2.5px)",this.ctx.fill(),this.ctx.filter="none",this.ctx.restore()}drawFallbackCircle(e){try{this.debug.warn("Drawing fallback circle");const{centerX:t,centerY:i,radius:n,pulsePhase:r,colors:a}=e;this.ctx.clearRect(0,0,e.width,e.height),this.ctx.save();const s=1+.1*Math.sin(r),c=n*s;this.ctx.beginPath(),this.ctx.arc(t,i,c+10,0,Math.PI*2),this.ctx.fillStyle=a.glow+"40",this.ctx.filter="blur(6px)",this.ctx.fill(),this.ctx.filter="none",this.ctx.beginPath(),this.ctx.arc(t,i,c,0,Math.PI*2),this.ctx.fillStyle=a.primary,this.ctx.fill(),this.ctx.restore(),this.debug.log("Fallback circle drawn successfully")}catch(t){throw this.debug.error("Even fallback drawing failed:",t),t}}}class U{constructor(e,t,i){this.isRunning=!1,this.animate=()=>{if(this.emergency.shouldSkipAnimation()){this.debug.warn("Animation stopped due to emergency stop"),this.stop();return}if(!this.isRunning){this.debug.log("Animation stopped by external request");return}this.debug.debug("🔍 [AnimationController] Animation frame start"),this.updateAnimationPhases(),this.isRunning&&!this.emergency.isEmergencyStopRequested()&&(this.state.animationFrameId=requestAnimationFrame(this.animate))},this.debug=e,this.emergency=t,this.renderer=i,this.state={pulsePhase:0,waveformPhase:0,gradientRotation:0,elapsedTime:0,displayedTime:0,timeTarget:60,idleFrame:0,idleFlash:0,lastActiveTime:Date.now(),animationFrameId:0}}start(){if(this.isRunning){this.debug.warn("Animation already running");return}this.debug.log("Starting animation loop"),this.isRunning=!0,this.emergency.clearEmergencyStop(),this.animate()}stop(){if(!this.isRunning){this.debug.warn("Animation already stopped");return}this.debug.log("Stopping animation loop"),this.isRunning=!1,this.state.animationFrameId&&(cancelAnimationFrame(this.state.animationFrameId),this.state.animationFrameId=0)}updateAnimationPhases(){this.state.pulsePhase+=.05,this.state.waveformPhase+=.08,this.state.gradientRotation+=.02,this.state.gradientRotation>Math.PI*2&&(this.state.gradientRotation-=Math.PI*2),this.state.idleFlash+=.08,this.state.idleFrame++,this.updateTimeDisplay()}updateTimeDisplay(){this.state.displayedTime+=(this.state.elapsedTime-this.state.displayedTime)*.18}render(e){if(this.emergency.shouldSkipAnimation())return;const t={...e,...this.state};this.emergency.safeCanvasOperation(()=>(this.renderer.renderAll(t),!0),()=>(this.renderer.drawFallbackCircle(t),!1),"render")}addRipple(e,t,i){Math.random()<.1&&e.push({radius:t,alpha:.4,speed:1+i*2})}addParticle(e,t,i,n){if(Math.random()<.05){const r=Math.random()*Math.PI*2,a=n+Math.random()*20;e.push({x:t+Math.cos(r)*a,y:i+Math.sin(r)*a,alpha:.8,size:2+Math.random()*3,speed:.5+Math.random()*1})}}setVolumeLevel(e){}markActivity(){this.state.lastActiveTime=Date.now(),this.debug.debug("User activity marked")}setListening(e){e&&this.markActivity(),this.debug.debug("Animation listening state:",e)}resetTime(){this.state.elapsedTime=0,this.state.displayedTime=0,this.debug.log("Animation time reset")}updateElapsedTime(e){this.state.elapsedTime=e}setTimeTarget(e){this.state.timeTarget=e,this.debug.log("Animation time target set to:",e)}getState(){return{...this.state}}isAnimating(){return this.isRunning}forceRestart(){this.debug.warn("🔧 Force restarting animation"),this.stop(),setTimeout(()=>{this.start()},50)}cleanup(){this.debug.log("Cleaning up animation controller"),this.stop(),this.state={pulsePhase:0,waveformPhase:0,gradientRotation:0,elapsedTime:0,displayedTime:0,timeTarget:60,idleFrame:0,idleFlash:0,lastActiveTime:Date.now(),animationFrameId:0}}}class K{constructor(e,t){this.canvas=null,this.resizeTimeout=null,this.debug=e,this.emergency=t,this.debouncedResize=this.debounce(()=>{this.safeResize()},150)}setCanvas(e){this.canvas=e,this.debug.log("Canvas reference set for dimensions manager")}initialize(){const e={width:400,height:400,centerX:200,centerY:200,radius:180};return this.debug.log("Dimensions initialized:",e),e}calculateDimensions(){if(!this.canvas||!this.canvas.parentElement)return this.debug.warn("Canvas or container not available, using fallback dimensions"),this.emergency.setFallbackDimensions();try{const t=this.canvas.parentElement.getBoundingClientRect();this.debug.debug("Container dimensions:",{width:t.width,height:t.height});const i=Math.max(200,t.width||400),n=Math.max(200,t.height||400),r=i/2,a=n/2,s=Math.max(60,Math.min(i,n)*.35),c={width:i,height:n,centerX:r,centerY:a,radius:s};return this.debug.log("Calculated dimensions:",c),c}catch(e){return this.debug.error("Error calculating dimensions:",e),this.emergency.setFallbackDimensions()}}applyDimensions(e){if(!this.canvas)return this.debug.error("Cannot apply dimensions - no canvas reference"),!1;try{return this.canvas.width=e.width,this.canvas.height=e.height,this.canvas.style.width=`${e.width}px`,this.canvas.style.height=`${e.height}px`,this.debug.log("Dimensions applied successfully:",e),!0}catch(t){return this.debug.error("Error applying dimensions:",t),!1}}safeResize(){if(this.debug.log("🔍 [DimensionsManager] Starting safe resize"),!this.emergency.startResize())return this.debug.warn("Resize operation blocked by emergency manager"),this.emergency.setFallbackDimensions();try{const e=this.calculateDimensions(),t=this.applyDimensions(e);return this.emergency.finishResize(t),t?(this.debug.log("Resize completed successfully"),e):(this.debug.warn("Resize failed, using fallback"),this.emergency.setFallbackDimensions())}catch(e){return this.debug.error("Resize operation failed:",e),this.emergency.finishResize(!1),this.emergency.setFallbackDimensions()}}setupResizeListener(){typeof window<"u"&&(window.addEventListener("resize",this.debouncedResize),this.debug.log("Resize listener attached"))}removeResizeListener(){typeof window<"u"&&(window.removeEventListener("resize",this.debouncedResize),this.debug.log("Resize listener removed"))}forceResize(){return this.debug.warn("🔧 Force resize triggered"),this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.safeResize()}debounce(e,t){return()=>{this.resizeTimeout&&clearTimeout(this.resizeTimeout),this.resizeTimeout=window.setTimeout(()=>{this.resizeTimeout=null,e()},t)}}validateDimensions(e){const{width:t,height:i,radius:n}=e;return t<=0||i<=0?(this.debug.error("Invalid dimensions: width or height is zero or negative"),!1):n<=0||n>Math.min(t,i)/2?(this.debug.error("Invalid radius: must be positive and fit within dimensions"),!1):!0}getOptimalRadius(e,t){return Math.max(60,Math.min(e,t)*.35)}updateDimensions(e,t){const i={...t,...e};return(e.width!==void 0||e.height!==void 0)&&(i.centerX=i.width/2,i.centerY=i.height/2),e.radius===void 0&&(e.width!==void 0||e.height!==void 0)&&(i.radius=this.getOptimalRadius(i.width,i.height)),this.validateDimensions(i)?(this.debug.log("Dimensions updated:",i),i):(this.debug.warn("Invalid dimensions provided, keeping current state"),t)}cleanup(){this.debug.log("Cleaning up dimensions manager"),this.removeResizeListener(),this.resizeTimeout&&(clearTimeout(this.resizeTimeout),this.resizeTimeout=null),this.canvas=null}}class J{constructor(e){this.debug=e,this.state={isListening:!1,isHovered:!1,isActive:!1,volumeLevel:0,mouseX:0,mouseY:0,isDarkMode:!1,colors:{primary:"#60a5fa",secondary:"#34d399",glow:"#10b981",name:"blue-green"},ripples:[],particles:[]},this.initializeDarkMode()}initializeDarkMode(){typeof window<"u"&&window.matchMedia&&(this.state.isDarkMode=window.matchMedia("(prefers-color-scheme: dark)").matches,window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",e=>{this.state.isDarkMode=e.matches,this.debug.log("Dark mode changed:",e.matches)}))}getState(){return{...this.state}}updateExternalState(e){let t=!1;e.isHovered!==void 0&&e.isHovered!==this.state.isHovered&&(this.state.isHovered=e.isHovered,t=!0),e.isActive!==void 0&&e.isActive!==this.state.isActive&&(this.state.isActive=e.isActive,t=!0),e.mousePosition&&(this.state.mouseX=e.mousePosition.x,this.state.mouseY=e.mousePosition.y,t=!0),t&&this.debug.debug("External state updated:",e)}setListening(e){this.state.isListening!==e&&(this.state.isListening=e,this.debug.log("Listening state changed:",e))}setVolumeLevel(e){const t=Math.max(0,Math.min(1,e));this.state.volumeLevel!==t&&(this.state.volumeLevel=t,this.debug.debug("Volume level updated:",t))}setMousePosition(e,t){this.state.mouseX=e,this.state.mouseY=t}updateColors(e){this.state.colors={...this.state.colors,...e},this.debug.log("Colors updated:",this.state.colors)}setColorScheme(e){this.state.colors={...e},this.debug.log("Color scheme set:",e)}addRipple(e,t=.4,i=1){this.state.ripples.push({radius:e,alpha:t,speed:i}),this.debug.debug("Ripple added:",{radius:e,alpha:t,speed:i})}addParticle(e,t,i=.8,n=2,r=1){this.state.particles.push({x:e,y:t,alpha:i,size:n,speed:r}),this.debug.debug("Particle added:",{x:e,y:t,alpha:i,size:n,speed:r})}clearRipples(){this.state.ripples=[],this.debug.debug("All ripples cleared")}clearParticles(){this.state.particles=[],this.debug.debug("All particles cleared")}clearAllEffects(){this.clearRipples(),this.clearParticles(),this.debug.log("All visual effects cleared")}isHovered(){return this.state.isHovered}isActive(){return this.state.isActive}isListening(){return this.state.isListening}getVolumeLevel(){return this.state.volumeLevel}getMousePosition(){return{x:this.state.mouseX,y:this.state.mouseY}}isDarkMode(){return this.state.isDarkMode}getColors(){return{...this.state.colors}}getRipples(){return this.state.ripples}getParticles(){return this.state.particles}reset(){this.debug.log("Resetting visual state");const e=this.state.colors,t=this.state.isDarkMode;this.state={isListening:!1,isHovered:!1,isActive:!1,volumeLevel:0,mouseX:0,mouseY:0,isDarkMode:t,colors:e,ripples:[],particles:[]}}getRenderState(){return{isListening:this.state.isListening,isHovered:this.state.isHovered,isActive:this.state.isActive,volumeLevel:this.state.volumeLevel,mouseX:this.state.mouseX,mouseY:this.state.mouseY,isDarkMode:this.state.isDarkMode,colors:{...this.state.colors},ripples:[...this.state.ripples],particles:[...this.state.particles]}}forceUpdateDarkMode(){if(typeof window<"u"&&window.matchMedia){const e=this.state.isDarkMode;this.state.isDarkMode=window.matchMedia("(prefers-color-scheme: dark)").matches,e!==this.state.isDarkMode&&this.debug.log("Dark mode force updated:",this.state.isDarkMode)}}}class R{constructor(e,t){this.isInitialized=!1,this.debug=new f,this.emergency=new G(this.debug),this.renderer=new q(null,this.debug),this.animation=new U(this.debug,this.emergency,this.renderer),this.dimensions=new K(this.debug,this.emergency),this.state=new J(this.debug),this.debug.log("🚀 [SiriButton] Modular architecture initializing..."),this.debug.log("  📦 Container ID:",e),t?(this.state.setColorScheme(t),this.debug.log("  🎨 Custom colors applied:",t)):this.state.setColorScheme({primary:"#5DB6B9",secondary:"#E8B554",glow:"rgba(93, 182, 185, 0.4)",name:"English"});const i={userAgent:navigator.userAgent,isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isTouch:"ontouchstart"in window,screen:{width:screen.width,height:screen.height,devicePixelRatio:window.devicePixelRatio}};this.debug.log("🔍 [SiriButton] DEVICE INFO:",i),this.initializeCanvas(e),this.setupModules(),this.startSystems(),this.debug.log("✅ [SiriButton] Modular initialization completed")}initializeCanvas(e){this.debug.log("🎨 [SiriButton] Initializing canvas for container:",e);const t=document.getElementById(e);if(!t)throw this.debug.error("❌ [SiriButton] Container element not found:",e),new Error(`Container element not found: ${e}`);this.canvas=document.createElement("canvas"),this.canvas.style.position="absolute",this.canvas.style.inset="2px",this.canvas.style.borderRadius="50%",this.canvas.style.display="block",this.canvas.style.background="transparent",this.canvas.style.zIndex="1",this.canvas.style.pointerEvents="none",this.canvas.setAttribute("data-siri-canvas","true"),this.canvas.setAttribute("data-mobile-debug",/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)?"mobile":"desktop"),this.canvas.id=`${e}-canvas`,t.appendChild(this.canvas);const i=this.canvas.getContext("2d");if(!i)throw this.debug.error("❌ [SiriButton] Could not get canvas context"),new Error("Could not get canvas context");this.ctx=i,this.debug.log("✅ [SiriButton] Canvas created and context obtained"),setTimeout(()=>{this.debug.debug("🔍 [SiriButton] CANVAS VERIFICATION:"),this.debug.debug("  🎨 Canvas in DOM:",document.contains(this.canvas)),this.debug.debug("  🎨 Canvas rect:",this.canvas.getBoundingClientRect())},200)}setupModules(){this.debug.log("🔧 [SiriButton] Setting up module configuration..."),this.emergency.setCanvasReferences(this.canvas,this.ctx),this.dimensions.setCanvas(this.canvas),this.renderer.ctx=this.ctx,this.dimensions.setupResizeListener(),this.debug.log("✅ [SiriButton] Module configuration completed")}startSystems(){this.debug.log("🚀 [SiriButton] Starting systems..."),this.currentDimensions=this.dimensions.initialize(),setTimeout(()=>{this.currentDimensions=this.dimensions.safeResize(),this.debug.log("📐 Initial resize completed:",this.currentDimensions),this.animation.start(),this.renderFrame(),this.isInitialized=!0,this.debug.log("✅ [SiriButton] All systems started")},100),setTimeout(()=>{this.currentDimensions=this.dimensions.safeResize(),this.renderFrame(),this.debug.log("📱 [SiriButton] Mobile compatibility resize completed")},300)}renderFrame(){if(!this.isInitialized||this.emergency.shouldSkipAnimation())return;const e=this.state.getRenderState(),t={...this.currentDimensions,...e,...this.animation.getState()};this.animation.render(t)}updateColors(e){this.state.setColorScheme(e),this.debug.log("🎨 [SiriButton] Colors updated:",e)}static setDebugLevel(e){f.setDebugLevel(e)}static getDebugLevel(){return f.getDebugLevel()}emergencyStopPublic(){this.emergency.triggerEmergencyStop(),this.animation.stop(),this.debug.warn("[SiriButton] Emergency stop triggered via public API")}setListening(e){this.state.setListening(e),this.animation.setListening(e),this.debug.log("🎤 [SiriButton] Listening state:",e)}setVolumeLevel(e){this.state.setVolumeLevel(e),this.animation.setVolumeLevel(e)}setTime(e,t=60){this.animation.updateElapsedTime(e),this.animation.setTimeTarget(t)}getTime(){const e=this.animation.getState();return{elapsed:e.elapsedTime,target:e.timeTarget}}setInteractionMode(e){const t={isHovered:e==="hover",isActive:e==="active"};this.state.updateExternalState(t),this.animation.markActivity(),this.debug.debug("👆 [SiriButton] Interaction mode:",e)}setTouchPosition(e,t){this.state.setMousePosition(e,t),this.state.updateExternalState({mousePosition:{x:e,y:t}})}updateVisualState(e){this.state.updateExternalState(e),this.animation.markActivity()}cleanup(){if(this.debug.log("🧹 [SiriButton] Cleaning up modular components..."),this.animation.stop(),this.animation.cleanup(),this.dimensions.cleanup(),this.state.reset(),this.canvas&&this.canvas.parentElement&&document.contains(this.canvas))try{this.canvas.parentElement.removeChild(this.canvas),this.debug.log("✅ [SiriButton] Canvas removed successfully")}catch(e){this.debug.warn("[SiriButton] Error removing canvas:",e)}this.canvas=null,this.ctx=null,this.isInitialized=!1,this.debug.log("✅ [SiriButton] Cleanup completed")}}typeof window<"u"&&(window.SiriDebugControls={setLevel:l=>{R.setDebugLevel(l),console.log(`🔧 Voice debug level set to: ${l}`)},getLevel:()=>R.getDebugLevel(),silent:()=>R.setDebugLevel(0),errorsOnly:()=>R.setDebugLevel(1),verbose:()=>R.setDebugLevel(2),help:()=>{console.log(`
🔧 SiriDebugControls Help:
- SiriDebugControls.silent()     -> Turn off all debug logs
- SiriDebugControls.errorsOnly() -> Show errors + warnings only  
- SiriDebugControls.verbose()    -> Show all debug logs
- SiriDebugControls.setLevel(n)  -> Set level manually (0-2)
- SiriDebugControls.getLevel()   -> Check current level

🚀 NEW: Modular Architecture
- Each module has independent debug logging
- Better error isolation and reporting
- Enhanced mobile debugging support
      `)}},window.voiceDebugOff=()=>R.setDebugLevel(0),window.voiceDebugOn=()=>R.setDebugLevel(2));const Q=({isListening:l,volumeLevel:e,colors:t,size:i=280})=>{const[n,r]=m.useState(0),[a,s]=m.useState([]);m.useEffect(()=>{let o,y=0;const b=x=>{x-y>=16&&(r(v=>v+.05),s(v=>v.map(C=>({...C,scale:C.scale+.02,opacity:C.opacity-.01})).filter(C=>C.opacity>0)),y=x),o=requestAnimationFrame(b)};return o=requestAnimationFrame(b),()=>{o&&cancelAnimationFrame(o)}},[]),m.useEffect(()=>{if(l){const o=setInterval(()=>{s(y=>[...y,{id:Date.now(),scale:1,opacity:.4}])},300);return()=>clearInterval(o)}},[l]);const c=1+.1*Math.sin(n),h=l?e*.3:0,u=c+h;return p.jsxs("div",{style:{position:"relative",width:i,height:i,display:"flex",alignItems:"center",justifyContent:"center"},children:[a.map(o=>p.jsx("div",{style:{position:"absolute",width:i,height:i,borderRadius:"50%",border:`2px solid ${t.primary}`,transform:`scale(${o.scale})`,opacity:o.opacity,pointerEvents:"none"}},o.id)),p.jsx("div",{style:{position:"absolute",width:i+40,height:i+40,borderRadius:"50%",background:`radial-gradient(circle, ${t.glow} 0%, transparent 70%)`,transform:`scale(${u})`,opacity:l?.8:.4,transition:"opacity 0.3s ease",pointerEvents:"none"}}),p.jsx("div",{style:{position:"absolute",width:i,height:i,borderRadius:"50%",background:`linear-gradient(135deg, ${t.primary}, ${t.secondary})`,transform:`scale(${u})`,boxShadow:`0 0 ${l?40:20}px ${t.glow}`,transition:"box-shadow 0.3s ease",display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:p.jsx("div",{style:{color:"white",fontSize:i*.25,textShadow:"0 0 20px rgba(255,255,255,0.8)",transform:`scale(${1+e*.2})`,transition:"transform 0.1s ease"},children:"🎤"})}),l&&p.jsx("div",{style:{position:"absolute",bottom:-40,left:"50%",transform:"translateX(-50%)",color:t.primary,fontSize:14,fontWeight:"bold",textAlign:"center",animation:"pulse 1.5s infinite"},children:"Listening..."}),p.jsx("style",{children:`
          @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
          }
        `})]})},T=()=>/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)||"ontouchstart"in window||navigator.maxTouchPoints>0,Z=()=>({isMobile:T(),hasTouch:"ontouchstart"in window,maxTouchPoints:navigator.maxTouchPoints||0,userAgent:navigator.userAgent,screenWidth:window.screen.width,screenHeight:window.screen.height,devicePixelRatio:window.devicePixelRatio||1}),_=l=>{const e=Z();console.log(`📱 [${l}] Device Info:`,{isMobile:e.isMobile,hasTouch:e.hasTouch,maxTouchPoints:e.maxTouchPoints,screen:`${e.screenWidth}x${e.screenHeight}`,dpr:e.devicePixelRatio})},ee=({isListening:l,volumeLevel:e,containerId:t,onCallStart:i,onCallEnd:n,language:r="en",colors:a})=>{const s=(g,...d)=>{},c=(g,...d)=>{},h=(g,...d)=>{console.error(`[SiriCallButton] ${g}`,...d)},u=m.useRef(null),o=m.useRef(!1),[y,b]=m.useState("idle"),[x,S]=m.useState(!1),v=m.useRef(!1),C=m.useRef(0),k=3,B=m.useRef(!1),M=m.useCallback(()=>{if(!o.current){o.current=!0;try{if(u.current){try{u.current.cleanup()}catch(d){c("Cleanup error:",d)}u.current=null}const g=document.getElementById(t);if(g)try{g.querySelectorAll("canvas").forEach(D=>{D.parentElement&&document.contains(D)&&D.parentElement.removeChild(D)})}catch(d){h("Failed to remove canvases:",d)}S(!1)}catch(g){h("Safe cleanup failed:",g)}}},[t]),z=m.useCallback(()=>{c(),B.current=!0;try{if(u.current)try{typeof u.current.emergencyStopPublic=="function"&&u.current.emergencyStopPublic()}catch(g){h("Failed to emergency stop SiriButton:",g)}M(),c("🚨 EMERGENCY STOP COMPLETED")}catch(g){h("Emergency stop failed:",g)}},[M]),I=m.useCallback((g,d)=>{u.current&&(u.current.setInteractionMode("active"),d&&u.current.setTouchPosition(d.x,d.y)),s("🎯 [SiriCallButton] Interaction start:",{position:d})},[]),F=m.useCallback(async g=>{if(s(),s("  🎯 Event type:",g.type),s("  🎯 Event target:",g.target),u.current&&(u.current.setInteractionMode("idle"),s()),v.current){s();return}v.current=!0,s(),s("  🎧 isListening:",l),s("  ✅ onCallStart available:",!!i),s("  ✅ onCallEnd available:",!!n);try{if(!l&&i){b("listening"),s("🎤 [SiriCallButton] 🟢 STARTING CALL - Calling onCallStart()...");try{await i(),s("🎤 [SiriCallButton] ✅ onCallStart() completed successfully")}catch(d){h("🎤 [SiriCallButton] ❌ onCallStart() error:",d),b("idle")}}else l&&n?(b("processing"),s("🛑 [SiriCallButton] 🔴 ENDING CALL - Calling onCallEnd()..."),n(),s("🛑 [SiriCallButton] ✅ onCallEnd() completed"),setTimeout(()=>b("idle"),500)):(s("🔔 [SiriCallButton] ⚠️ NO ACTION TAKEN:"),s("  🎧 isListening:",l),s("  🎤 onCallStart available:",!!i),s("  🛑 onCallEnd available:",!!n))}finally{setTimeout(()=>{v.current=!1,s()},100)}s()},[l,i,n]),L=m.useCallback(g=>{u.current&&u.current.setInteractionMode(g?"hover":"idle")},[]);m.useEffect(()=>{if(T())return s(),S(!0),()=>{v.current=!1,s()};if(B.current){c();return}if(C.current++,C.current>k){h("Too many initialization attempts, triggering emergency stop"),z();return}o.current=!1,B.current=!1,s();const d=document.getElementById(t);if(!d){c("Container element not found:",t);return}d.querySelectorAll("canvas").forEach(E=>{E.parentElement&&document.contains(E)&&E.parentElement.removeChild(E)});try{u.current=new R(t,a),S(!0),setTimeout(()=>{u.current&&!o.current&&!B.current&&(s("🔧 [SiriCallButton] Single resize for mobile compatibility"),window.dispatchEvent(new Event("resize")))},200)}catch(E){h("Init error:",E),C.current<k?setTimeout(()=>{if(!o.current&&!B.current)try{u.current=new R(t,a),S(!0),s("🔧 [SiriCallButton] Retry successful - no additional resize needed")}catch(A){h("Retry failed:",A),C.current>=k&&z()}},200):(h("Max init attempts reached, triggering emergency stop"),z())}const $=T();if(_("SiriCallButton"),console.log("📱 [SiriCallButton] Device detection - isMobile:",$),$)return()=>{M()};{const E=()=>{L(!0),console.log("🖱️ [SiriCallButton] 🟢 DESKTOP Mouse enter")},A=()=>{L(!1),console.log("🖱️ [SiriCallButton] 🔴 DESKTOP Mouse leave")},O=w=>{console.log("🖱️ [SiriCallButton] 🔽 DESKTOP Mouse down - event target:",w.target),console.log("🖱️ [SiriCallButton] 🔽 Element ID:",d.id),console.log("🖱️ [SiriCallButton] 🔽 isHandlingClick before:",v.current);const H=d.getBoundingClientRect();I(w,{x:w.clientX-H.left,y:w.clientY-H.top}),console.log("🖱️ [SiriCallButton] 🔽 Mouse down completed")},V=w=>{console.log("🖱️ [SiriCallButton] 🔼 DESKTOP Mouse up - event target:",w.target),console.log("🖱️ [SiriCallButton] 🔼 onCallStart available:",!!i),console.log("🖱️ [SiriCallButton] 🔼 isListening state:",l),console.log("🖱️ [SiriCallButton] 🔼 isHandlingClick before:",v.current),F(w),console.log("🖱️ [SiriCallButton] 🔼 Mouse up - triggering action completed")};console.log("🖱️ [SiriCallButton] 🎯 DESKTOP EVENT SETUP:"),console.log("  📦 Element ID:",d.id),console.log("  📦 Element tagName:",d.tagName),console.log("  🎛️ onCallStart available:",!!i),console.log("  🎛️ onCallEnd available:",!!n),console.log("  🎨 Element computed style:",window.getComputedStyle(d).pointerEvents);const j=w=>{console.log("🎯 [SiriCallButton] 🔥 MANUAL TEST CLICK DETECTED!"),console.log("  🎯 Click target:",w.target),console.log("  🎯 Click coordinates:",w.clientX,w.clientY),console.log("  🎯 Element rect:",d.getBoundingClientRect()),console.log("  🎯 onCallStart available:",!!i)};return d.addEventListener("click",j),d.addEventListener("mouseenter",E),d.addEventListener("mouseleave",A),d.addEventListener("mousedown",O),d.addEventListener("mouseup",V),console.log("🖱️ [SiriCallButton] ✅ Desktop mouse events added successfully"),()=>{console.log("🖱️ [SiriCallButton] 🧹 Cleaning up desktop mouse events"),v.current=!1,s(),d.removeEventListener("click",j),d.removeEventListener("mouseenter",E),d.removeEventListener("mouseleave",A),d.removeEventListener("mousedown",O),d.removeEventListener("mouseup",V),M()}}},[t,a,I,F,L,M,i,l]),m.useEffect(()=>{u.current&&!o.current&&(u.current.setListening(l),console.log("🔧 [SiriCallButton] Listening state updated without resize trigger"))},[l,t]),m.useEffect(()=>{u.current&&!o.current&&u.current.setVolumeLevel(e)},[e]),m.useEffect(()=>{u.current&&a&&!o.current&&u.current.updateColors(a)},[a]);const P=async g=>{if(g.type==="touchend"||g.type==="click"){if(s(),s("  📱 Event type:",g.type),s("  📱 Event target:",g.target),v.current){s();return}v.current=!0,s(),s("  🎧 isListening:",l),s("  ✅ onCallStart available:",!!i),s("  ✅ onCallEnd available:",!!n);try{if(!l&&i){b("listening"),s("📱 [SiriCallButton] 🟢 MOBILE - STARTING CALL");try{await i(),s("📱 [SiriCallButton] ✅ Mobile onCallStart() completed successfully")}catch(d){h("📱 [SiriCallButton] ❌ Mobile onCallStart() error:",d),b("idle")}}else l&&n?(b("processing"),s("📱 [SiriCallButton] 🔴 MOBILE - ENDING CALL"),n(),s("📱 [SiriCallButton] ✅ Mobile onCallEnd() completed"),setTimeout(()=>b("idle"),500)):(s("📱 [SiriCallButton] ⚠️ MOBILE NO ACTION TAKEN:"),s("  📱 isListening:",l),s("  📱 onCallStart available:",!!i),s("  📱 onCallEnd available:",!!n))}finally{setTimeout(()=>{v.current=!1,s()},100)}s()}};return p.jsxs("div",{id:t,className:"voice-button",onTouchStart:P,onTouchEnd:P,onClick:P,style:{width:"100%",height:"100%",position:"relative",cursor:"pointer",zIndex:10,borderRadius:"50%",pointerEvents:"auto",overflow:"visible",touchAction:"manipulation",WebkitTapHighlightColor:"transparent",WebkitUserSelect:"none",userSelect:"none",WebkitTouchCallout:"none"},children:[!1,T()&&x&&p.jsx("div",{style:{position:"absolute",inset:0,display:"flex",alignItems:"center",justifyContent:"center",pointerEvents:"none"},children:p.jsx(Q,{isListening:l,volumeLevel:e,colors:a||{primary:"#5DB6B9",secondary:"#E8B554",glow:"rgba(93, 182, 185, 0.4)",name:"English"},size:Math.min(300,Math.min(parseInt(getComputedStyle(document.getElementById(t)||document.body).width)-20,parseInt(getComputedStyle(document.getElementById(t)||document.body).height)-20))})}),!x&&!T()&&p.jsx("div",{className:"absolute inset-0 rounded-full flex items-center justify-center",style:{background:`linear-gradient(135deg, ${a?.primary||"#5DB6B9"}, ${a?.secondary||"#E8B554"})`,color:"white",fontSize:"36px",boxShadow:`0 0 30px ${a?.glow||"rgba(93, 182, 185, 0.4)"}`,border:"2px solid rgba(255,255,255,0.1)",pointerEvents:"none"},children:"🎤"}),y!=="idle"&&y!=="listening"&&p.jsx("div",{className:`status-indicator ${y}`,style:{position:"absolute",top:"-48px",left:"50%",transform:"translateX(-50%)",color:a?.primary||"#5DB6B9",textShadow:`0 0 10px ${a?.glow||"rgba(93, 182, 185, 0.4)"}`,pointerEvents:"none"},children:y==="processing"?"Processing...":"Speaking..."})]})},N={en:{primary:"#5DB6B9",secondary:"#E8B554",glow:"rgba(93, 182, 185, 0.4)",name:"English"},fr:{primary:"#8B5CF6",secondary:"#A78BFA",glow:"rgba(139, 92, 246, 0.4)",name:"Français"},zh:{primary:"#EF4444",secondary:"#FCA5A5",glow:"rgba(239, 68, 68, 0.4)",name:"中文"},ru:{primary:"#10B981",secondary:"#6EE7B7",glow:"rgba(16, 185, 129, 0.4)",name:"Русский"},ko:{primary:"#F59E0B",secondary:"#FDE68A",glow:"rgba(245, 158, 11, 0.4)",name:"한국어"},vi:{primary:"#EC4899",secondary:"#F9A8D4",glow:"rgba(236, 72, 153, 0.4)",name:"Tiếng Việt"}},ne=({isCallStarted:l,micLevel:e,onCallStart:t,onCallEnd:i,onCancel:n,onConfirm:r,showingSummary:a=!1})=>{const{language:s}=Y(),c=W(),[h,u]=m.useState(!1),o=N[s]||N.en;console.log("🎨 [SiriButtonContainer] Language:",s,"Colors:",o.name,"Primary:",o.primary),console.log("📏 [SiriButtonContainer] Responsive size:",c),m.useEffect(()=>{l||u(!1)},[l]);const y=async x=>{if(h){console.log("🛡️ [SiriButtonContainer] Call start blocked - confirming in progress");return}console.log("🎤 [SiriButtonContainer] Starting call normally..."),await t(x)},b=()=>{console.log("✅ [SiriButtonContainer] Confirming call");try{r(),console.log("✅ [SiriButtonContainer] Call confirmed successfully")}catch(x){if(console.error("❌ [SiriButtonContainer] Error confirming call:",x),typeof window<"u"){const S=x instanceof Error?x.message:"Lỗi không xác định";alert(`Lỗi khi xác nhận cuộc gọi: ${S}`)}}};return p.jsxs("div",{className:"flex flex-col items-center justify-center w-full relative",style:{marginBottom:X.spacing.xl,zIndex:9999,pointerEvents:"auto",height:"400px",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center"},children:[p.jsxs("div",{className:"flex items-center justify-center gap-4 w-full max-w-sm px-4",style:{position:"absolute",top:"20px",left:"50%",transform:"translateX(-50%)",height:"40px",opacity:0,visibility:"hidden",pointerEvents:"none",transition:"opacity 0.3s ease-in-out",zIndex:1},children:[p.jsx("button",{onClick:n,disabled:!0,className:"px-4 py-2 bg-red-500 hover:bg-red-600 text-white rounded-full text-sm font-semibold transition-all duration-200 active:scale-95",style:{minWidth:"80px"},children:"Cancel"}),p.jsx("button",{onClick:b,disabled:!0,className:"px-4 py-2 bg-green-500 hover:bg-green-600 text-white rounded-full text-sm font-semibold transition-all duration-200 active:scale-95",style:{minWidth:"80px"},children:"Confirm"})]}),p.jsx("div",{className:`relative transition-all duration-500 ease-in-out voice-button ${l?"listening":""} ${h?"confirming":""}`,"data-language":s,style:{width:c.width,height:c.height,minWidth:c.minWidth,minHeight:c.minHeight,maxWidth:c.maxWidth,maxHeight:c.maxHeight,borderRadius:"50%",boxShadow:h?"0 10px 20px rgba(128, 128, 128, 0.3), 0 0 30px rgba(128, 128, 128, 0.2)":`0 20px 40px ${o.glow}, 0 0 60px ${o.glow}`,background:h?"linear-gradient(135deg, #80808020, #80808010)":`linear-gradient(135deg, ${o.primary}15, ${o.secondary}10)`,backdropFilter:"blur(10px)",border:h?"2px solid #80808040":`2px solid ${o.primary}40`,cursor:h?"not-allowed":"pointer",touchAction:"manipulation",opacity:h?.6:1,position:"relative",flexShrink:0,alignSelf:"center",aspectRatio:"1",margin:"0 auto",contain:"layout style"},children:p.jsx(ee,{containerId:"main-siri-button",isListening:l,volumeLevel:e,onCallStart:()=>y(s),onCallEnd:i,language:s,colors:o})}),p.jsx("div",{className:"block mt-4 text-center transition-all duration-300",style:{fontSize:"1rem",fontWeight:"600"},children:h?p.jsx("div",{style:{color:"#808080",textShadow:"0 2px 8px rgba(128, 128, 128, 0.3)"},children:"📋 Processing call summary..."}):l?p.jsx("div",{style:{color:o.primary,textShadow:`0 2px 8px ${o.glow}`},children:"🎤 Listening... Tap to end call"}):p.jsx("div",{style:{color:o.primary,textShadow:`0 2px 8px ${o.glow}`},children:"Tap To Speak"})}),!1]})};export{ne as S};
