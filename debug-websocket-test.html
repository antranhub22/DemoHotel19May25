<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Connection Test</title>
</head>

<body>
    <h1>🔌 WebSocket Connection Debug Test</h1>
    <div id="status"></div>
    <div id="logs"></div>

    <script src="https://cdn.socket.io/4.6.0/socket.io.min.js"></script>
    <script>
        const statusDiv = document.getElementById('status');
        const logsDiv = document.getElementById('logs');

        function log(message) {
            console.log(message);
            logsDiv.innerHTML += `<div>${new Date().toISOString()}: ${message}</div>`;
        }

        log('🔌 [DEBUG] Starting direct WebSocket test...');

        // Test direct connection to localhost
        const testUrls = [
            'http://localhost:3000',
            'http://localhost:5000',
            'http://127.0.0.1:3000',
            'http://127.0.0.1:5000'
        ];

        async function testConnection(url) {
            return new Promise((resolve) => {
                log(`🔌 [DEBUG] Testing connection to: ${url}`);

                const socket = io(url, {
                    transports: ['websocket', 'polling'],
                    timeout: 5000,
                    reconnection: false
                });

                socket.on('connect', () => {
                    log(`✅ [DEBUG] SUCCESS: Connected to ${url}`);
                    statusDiv.innerHTML = `✅ Connected to ${url}`;
                    socket.disconnect();
                    resolve({ url, success: true });
                });

                socket.on('connect_error', (error) => {
                    log(`❌ [DEBUG] FAILED: Connection to ${url} failed: ${error.message}`);
                    resolve({ url, success: false, error: error.message });
                });

                socket.on('disconnect', () => {
                    log(`🔌 [DEBUG] Disconnected from ${url}`);
                });

                // Timeout after 5 seconds
                setTimeout(() => {
                    socket.disconnect();
                    resolve({ url, success: false, error: 'Timeout' });
                }, 5000);
            });
        }

        async function runTests() {
            log('🔌 [DEBUG] Running connection tests...');

            for (const url of testUrls) {
                const result = await testConnection(url);
                if (result.success) {
                    log(`✅ [DEBUG] Found working server at: ${result.url}`);
                    break;
                }
            }

            log('🔌 [DEBUG] Connection tests completed');
        }

        // Run tests when page loads
        runTests();
    </script>
</body>

</html>